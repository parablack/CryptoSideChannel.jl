<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Masking · CryptoSideChannel.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CryptoSideChannel.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../ciphers/">Ciphers</a></li><li><span class="tocitem">Types</span><ul><li><a class="tocitem" href="../integer-types/">Integer Types</a></li><li><a class="tocitem" href="../logging/">Logging</a></li><li class="is-active"><a class="tocitem" href>Masking</a><ul class="internal"><li><a class="tocitem" href="#Masking-Types"><span>Masking Types</span></a></li><li><a class="tocitem" href="#masking_problems"><span>Problems with High-level Masking</span></a></li><li><a class="tocitem" href="#extending_masking_funs"><span>Defining new methods for <code>Masked</code> types</span></a></li></ul></li><li><a class="tocitem" href="../create-traces/">Create your own traces</a></li></ul></li><li><span class="tocitem">Attacks</span><ul><li><a class="tocitem" href="../../attacks/dpa/">DPA</a></li><li><a class="tocitem" href="../../attacks/cpa/">CPA</a></li><li><a class="tocitem" href="../../attacks/template/">Template</a></li><li><a class="tocitem" href="../../attacks/keycombination/">Key combination</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Types</a></li><li class="is-active"><a href>Masking</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Masking</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/parablack/CryptoSideChannel.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Masking"><a class="docs-heading-anchor" href="#Masking">Masking</a><a id="Masking-1"></a><a class="docs-heading-anchor-permalink" href="#Masking" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="CryptoSideChannel.Masking.Masked" href="#CryptoSideChannel.Masking.Masked"><code>CryptoSideChannel.Masking.Masked</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct Masked{M, T1, T2}
    val::T1
    mask::T2
end</code></pre><p>The <code>Masked</code> datatype behaves like an integer, but splits its internal value into two shares. Hence, the plain value held by a <code>Masked</code> type should not be observable in memory</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>The above statement holds <strong>only in theory</strong>. See the article on <a href="#masking_problems">problems with high-level software masking</a> for details on this problem.</p></div></div><p><strong>Type Arguments</strong></p><ul><li><code>M</code> is the way in which the underlying value is masked. <code>M</code> can be either <code>Boolean</code> or <code>Arithmetic</code>, representing <a href="#boolean_masking">boolean masking</a> or <a href="#arithmetic_masking">arithmetic masking</a>, respectively.</li><li><code>T1</code> is the type of the first share. This can be any integer-like type: A primitive integer, a <code>GenericLog</code> type, or another <code>Masked</code> type for higher-order masking.</li><li><code>T2</code> is the type of the second share. This should <strong>always</strong> be either a primitive integer type, or a <code>GenericLog</code> type.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/parablack/CryptoSideChannel.jl">source</a></section></article><p>It may be useful to extract the content of a <code>Masked</code> type, for example at the end of a cryptographic calculation.</p><article class="docstring"><header><a class="docstring-binding" id="CryptoSideChannel.Masking.unmask" href="#CryptoSideChannel.Masking.unmask"><code>CryptoSideChannel.Masking.unmask</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">unmask(a::Masked)</code></pre><p>Unmask the contained integer by calculating <code>val ⊻ mask</code>, or <code>val + mask</code> respectively.</p><p>Note that this function is <em>unsafe</em> with respect to side-channels. After calling this function, the data will no longer be split into two shares. Thus, this method should only be called at the end of a cryptographic algorithm to extract the final result.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/parablack/CryptoSideChannel.jl">source</a></section></article><h2 id="Masking-Types"><a class="docs-heading-anchor" href="#Masking-Types">Masking Types</a><a id="Masking-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Masking-Types" title="Permalink"></a></h2><h3 id="boolean_masking"><a class="docs-heading-anchor" href="#boolean_masking">Boolean Masking</a><a id="boolean_masking-1"></a><a class="docs-heading-anchor-permalink" href="#boolean_masking" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="CryptoSideChannel.Masking.BooleanMask" href="#CryptoSideChannel.Masking.BooleanMask"><code>CryptoSideChannel.Masking.BooleanMask</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">BooleanMask(v)</code></pre><p>Create a masked integer holding value <code>v</code>. Internally, <code>v</code> will be stored in two shares, <code>val</code> and <code>mask</code>, such that <code>v</code> = <code>val ⊻ mask</code>. The latter condition is an invariant of this datatype.</p><p>It should always be the case that <code>mask</code> is a primitive type, i.e. of the type <code>Integer</code> or <code>GenericLog</code>. If higher-order masking is desired, <code>val</code> can be of the type <code>Masked</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/parablack/CryptoSideChannel.jl">source</a></section></article><h3 id="arithmetic_masking"><a class="docs-heading-anchor" href="#arithmetic_masking">Arithmetic Masking</a><a id="arithmetic_masking-1"></a><a class="docs-heading-anchor-permalink" href="#arithmetic_masking" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="CryptoSideChannel.Masking.ArithmeticMask" href="#CryptoSideChannel.Masking.ArithmeticMask"><code>CryptoSideChannel.Masking.ArithmeticMask</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ArithmeticMask(v)</code></pre><p>Create a masked integer holding value <code>v</code>. Internally, <code>v</code> will be stored in two shares, <code>val</code> and <code>mask</code>, such that <code>v</code> = <code>val - mask</code>. The latter condition is an invariant of this datatype.</p><p>It should always be the case that <code>mask</code> is a primitive type, i.e. of the type <code>Integer</code> or <code>GenericLog</code>. If higher-order masking is desired, <code>val</code> can be of the type <code>Masked</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/parablack/CryptoSideChannel.jl">source</a></section></article><h3 id="Conversion"><a class="docs-heading-anchor" href="#Conversion">Conversion</a><a id="Conversion-1"></a><a class="docs-heading-anchor-permalink" href="#Conversion" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="CryptoSideChannel.Masking.arithmeticToBoolean" href="#CryptoSideChannel.Masking.arithmeticToBoolean"><code>CryptoSideChannel.Masking.arithmeticToBoolean</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">arithmeticToBoolean(a::Masked{Arithmetic})::Masked{Boolean}</code></pre><p>Execute the algorithm outlined in <a href="http://www.goubin.fr/papers/arith-final.pdf">Goubin&#39;s paper</a> to convert from algebraic shares to boolean shares.</p><p>See also: <a href="#CryptoSideChannel.Masking.arithmeticToBoolean"><code>arithmeticToBoolean</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/parablack/CryptoSideChannel.jl">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CryptoSideChannel.Masking.booleanToArithmetic" href="#CryptoSideChannel.Masking.booleanToArithmetic"><code>CryptoSideChannel.Masking.booleanToArithmetic</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">booleanToArithmetic(a::Masked{Boolean})::Masked{Arithmetic}</code></pre><p>Execute the algorithm outlined in <a href="http://www.goubin.fr/papers/arith-final.pdf">Goubin&#39;s paper</a> to convert from boolean shares to algebraic shares.</p><p>See also: <a href="#CryptoSideChannel.Masking.arithmeticToBoolean"><code>arithmeticToBoolean</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/parablack/CryptoSideChannel.jl">source</a></section></article><h2 id="masking_problems"><a class="docs-heading-anchor" href="#masking_problems">Problems with High-level Masking</a><a id="masking_problems-1"></a><a class="docs-heading-anchor-permalink" href="#masking_problems" title="Permalink"></a></h2><p>We defined our <code>Masked</code> datatype as a construct in the high-level Julia language. This poses some problems with respect to compiler optimisations. Essentially, all masking security guarantees rely on the fact that some intermediate values will never appear in memory. However, the masking approach introduces new, &quot;unneccessary&quot; computation instructions. Depending on compiler optimisations, some of the masking steps may be removed in the final executable.</p><p>For example, consider the masked array lookup. Recall that for a table lookup <span>$Y = T[X]$</span>, with <span>$X = A_X \oplus M_X$</span> a table <span>$T&#39;$</span> with <span>$T&#39;[X] = T[X \oplus M_X] \oplus M&#39;_X$</span> is computed. Later on, the table is only accessed at index <span>$A_X$</span>. Hence, a compiler may notice that all other fields of the table are never accessed, and may optimize the code in the final program to only compute <span>$T&#39;[A_X] = T[A_X \oplus M_X] \oplus M&#39;_X$</span>. However, note that for computing the latter, <span>$A_X \oplus M_X$</span> appears as an intermediate result. Thus, this may allow conclusions about the unmasked value.</p><p>The consequences of this issues are simple: This project is for academic, testing, and educational purposes only. Do not use the <code>Masked</code> datatype as a protection in a real-world system. Exploring ways to preserve masking through compiler optimisations in Julia could be done in future work.</p><h2 id="extending_masking_funs"><a class="docs-heading-anchor" href="#extending_masking_funs">Defining new methods for <code>Masked</code> types</a><a id="extending_masking_funs-1"></a><a class="docs-heading-anchor-permalink" href="#extending_masking_funs" title="Permalink"></a></h2><p>It is possible to extend the provided methods for <code>Masked</code> types with custom methods.</p><p>The first decision that has to be made is whether the operation should be implemented for arithmetic masking or for boolean masking. In general, methods requiring arithmetic over <span>$\mathbb{Z}$</span> are suitable for arithmetic masking, while methods using bitwise operations often require boolean masking.</p><p>Next, the desired operator has to be implemented. For example, we will show how to implement the boolean negation <code>~</code>. Since this operator works bitwise, we will immplement the masked version on boolean masking. Recall that we want to invert a value <span>$X = A_X \oplus M_X$</span>. Here, it is sufficient to simply invert the mask:</p><pre><code class="language-julia hljs">function Base.:(~)(a::Masked{Boolean})::Masked{Boolean}
    Masked{Boolean,typeof(a.val),typeof(a.mask)}(a.val, ~a.mask)
end</code></pre><p>To complete this definition for all masked datatypes, we need to define the method for arithmetic masking as well. However, now simple conversion can be used to convert from arithmetic to boolean masking:</p><pre><code class="language-julia hljs">Base.:(~)(a::Masked{Arithmetic}) = ~arithmeticToBoolean(a)</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"></div></div><p>Be cautious when extending the <code>Masked</code> datatype. During any new custom operation the unmasked value should never be computed.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../logging/">« Logging</a><a class="docs-footer-nextpage" href="../create-traces/">Create your own traces »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.4 on <span class="colophon-date" title="Tuesday 27 July 2021 12:28">Tuesday 27 July 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
